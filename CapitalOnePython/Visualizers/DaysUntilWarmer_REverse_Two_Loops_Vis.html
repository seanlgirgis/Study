<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reverse Traversal (Jump) Visualizer</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;600;700&display=swap');

        :root {
            --bg-color: #0f172a;
            --panel-bg: #1e293b;
            --border-color: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --accent-color: #f59e0b;
            /* Amber for jump */
            --bar-default: #475569;
            --bar-current: #a855f7;
            /* Purple for current i */
            --bar-j: #f59e0b;
            /* Amber for j (scanner) */
            --bar-solved: #10b981;
            /* Green when solved */
            --jump-arc: #f59e0b;
        }

        body {
            font-family: 'JetBrains Mono', monospace;
            background-color: var(--bg-color);
            color: var(--text-primary);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        h1 {
            margin-bottom: 5px;
            font-size: 1.5rem;
        }

        p.subtitle {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 20px;
        }

        .container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            width: 100%;
            max-width: 1200px;
        }

        .panel {
            background-color: var(--panel-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        /* Visualization Area */
        #viz-container {
            height: 400px;
            position: relative;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            gap: 15px;
            /* Wider gap for jump arcs */
            padding-bottom: 40px;
            padding-top: 60px;
            /* Space for arcs */
        }

        .bar-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
            height: 100%;
            width: 50px;
            position: relative;
        }

        .bar {
            width: 100%;
            background-color: var(--bar-default);
            border-radius: 4px 4px 0 0;
            transition: height 0.3s ease, background-color 0.3s ease;
            position: relative;
            z-index: 2;
        }

        .bar-value {
            position: absolute;
            top: -20px;
            font-size: 0.8rem;
            color: var(--text-secondary);
            font-weight: bold;
        }

        .bar-index {
            position: absolute;
            bottom: -25px;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .bar-result {
            position: absolute;
            bottom: -45px;
            font-size: 0.9rem;
            color: var(--bar-solved);
            font-weight: bold;
            opacity: 0.3;
            transition: opacity 0.3s;
        }

        .bar-result.solved {
            opacity: 1;
            text-shadow: 0 0 5px var(--bar-solved);
        }

        /* Jump Arcs (SVG Overlay) */
        #svg-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
        }

        /* Legend */
        .legend {
            display: flex;
            gap: 15px;
            margin-top: 10px;
            font-size: 0.8rem;
            color: var(--text-secondary);
            justify-content: center;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        /* Controls */
        .controls {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            justify-content: center;
            width: 100%;
        }

        button {
            padding: 10px 20px;
            background-color: var(--panel-bg);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            border-radius: 8px;
            cursor: pointer;
            font-family: inherit;
            font-weight: 600;
            transition: all 0.2s;
        }

        button:hover {
            background-color: var(--border-color);
        }

        button.active {
            background-color: var(--accent-color);
            border-color: var(--accent-color);
            color: #fff;
        }

        /* Code Trace */
        .code-line {
            padding: 2px 8px;
            border-radius: 4px;
            color: var(--text-secondary);
            font-size: 0.85rem;
            border-left: 3px solid transparent;
            font-family: 'JetBrains Mono', monospace;
        }

        .code-line.active {
            background-color: rgba(245, 158, 11, 0.1);
            color: var(--text-primary);
            border-left-color: var(--accent-color);
        }

        /* Status & Log */
        #status-text {
            margin-bottom: 15px;
            font-weight: bold;
            color: var(--accent-color);
            min-height: 1.2em;
            font-size: 1.1rem;
        }

        .variable-watch {
            display: flex;
            gap: 15px;
            margin-top: 15px;
            font-size: 0.9rem;
            color: var(--text-secondary);
            background: #0f172a;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .var-name {
            color: #fca5a5;
        }

        .var-val {
            color: #fff;
            font-weight: bold;
            margin-left: 5px;
        }
    </style>
</head>

<body>

    <h1>üöÄ Reverse Traversal (Jump) Visualizer</h1>
    <p class="subtitle">O(N) Logic: Scanning backwards and skipping known gaps</p>

    <!-- Controls -->
    <div class="controls">
        <button onclick="loadExample(0)">Classic</button>
        <button onclick="loadExample(1)">Wavy</button>
        <button onclick="loadExample(2)">Strictly Increasing</button>
        <button onclick="loadExample(3)">Plateau</button>
        <div style="width: 20px;"></div>
        <button onclick="reset()">‚èÆ Reset</button>
        <button onclick="step()">‚ñ∂ Step</button>
        <button onclick="play()" id="play-btn">‚ñ∂ Play</button>
    </div>

    <!-- Main Grid -->
    <div class="container" style="margin-top: 20px;">

        <!-- Left: Visualization -->
        <div class="panel" style="grid-column: span 2;">
            <div id="status-text">Ready to start...</div>

            <div id="viz-container">
                <svg id="svg-overlay"></svg>
            </div>

            <div class="legend">
                <div class="legend-item">
                    <div class="dot" style="background:var(--bar-current)"></div> Current Day (i)
                </div>
                <div class="legend-item">
                    <div class="dot" style="background:var(--bar-j)"></div> Scanner (j)
                </div>
                <div class="legend-item">
                    <div class="dot" style="background:var(--bar-solved)"></div> Solved (ret)
                </div>
            </div>

            <div class="variable-watch">
                <div><span class="var-name">i:</span> <span id="var-i" class="var-val">-</span></div>
                <div><span class="var-name">temps[i]:</span> <span id="var-ti" class="var-val">-</span></div>
                <div style="width:20px"></div>
                <div><span class="var-name">j:</span> <span id="var-j" class="var-val">-</span></div>
                <div><span class="var-name">temps[j]:</span> <span id="var-tj" class="var-val">-</span></div>
                <div><span class="var-name">ret[j]:</span> <span id="var-rj" class="var-val">-</span></div>
            </div>
        </div>

        <!-- Right: Code Trace -->
        <div class="panel">
            <h3 style="margin-top:0; font-size:1rem; color:#94a3b8; text-transform: uppercase; letter-spacing: 1px;">
                Algorithm Trace</h3>
            <div id="code-box">
                <div class="code-line" id="line-1">n = len(temps); ret = [0]*n</div>
                <div class="code-line" id="line-2">for i in range(n-1, -1, -1):</div>
                <div class="code-line" id="line-3">&nbsp;&nbsp;j = i + 1</div>
                <div class="code-line" id="line-4">&nbsp;&nbsp;while j < n and temps[j] <=temps[i]:</div>
                        <div class="code-line" id="line-5">&nbsp;&nbsp;&nbsp;&nbsp;if ret[j] == 0:</div>
                        <div class="code-line" id="line-6">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;j = n; break # Dead end
                        </div>
                        <div class="code-line" id="line-7">&nbsp;&nbsp;&nbsp;&nbsp;j += ret[j] # JUMP!</div>
                        <div class="code-line" id="line-8">&nbsp;&nbsp;if j < n:</div>
                                <div class="code-line" id="line-9">&nbsp;&nbsp;&nbsp;&nbsp;ret[i] = j - i</div>
                        </div>

                        <div
                            style="margin-top: 20px; padding: 10px; background: #0f172a; border-radius: 8px; font-size: 0.85rem; color: #94a3b8; line-height: 1.5;">
                            <strong>Why is this O(N)?</strong><br>
                            Even though there is a while loop, each index is 'jumped over' at most once during the
                            entire execution. The 'j' scanner never re-scans indices that are already known to be
                            smaller.
                        </div>
                </div>
            </div>

            <script>
                const EXAMPLES = [
                    [73, 74, 75, 71, 69, 72, 76, 73], // Classic
                    [60, 65, 62, 70, 68, 75],          // Wavy
                    [30, 40, 50, 60],                 // Increasing
                    [70, 70, 71, 70, 72]              // Plateau
                ];

                let temps = [];
                let steps = [];
                let currentStep = 0;
                let isPlaying = false;
                let playInterval = null;

                function computeSteps(data) {
                    const history = [];
                    const n = data.length;
                    const ret = new Array(n).fill(0);

                    history.push({ type: 'init', activeLine: 1, desc: 'Initialize result array with 0s.', i: -1, j: -1, ret: [...ret] });

                    for (let i = n - 1; i >= 0; i--) {
                        const ti = data[i];
                        history.push({ type: 'loop_start', activeLine: 2, desc: `Start Day ${i} (${ti}¬∞).`, i: i, j: -1, ret: [...ret] });

                        let j = i + 1;
                        history.push({ type: 'init_j', activeLine: 3, desc: `Check next day j=${j}.`, i: i, j: j, ret: [...ret] });

                        while (j < n && data[j] <= ti) {
                            history.push({ type: 'check_while', activeLine: 4, desc: `Is Day ${j} (${data[j]}¬∞) <= Day ${i} (${ti}¬∞)? YES.`, i: i, j: j, ret: [...ret] });

                            if (ret[j] === 0) {
                                history.push({ type: 'dead_end', activeLine: 5, desc: `Day ${j} has no warmer future (ret[j]==0). Dead end!`, i: i, j: j, ret: [...ret] });
                                j = n; // break
                                history.push({ type: 'break', activeLine: 6, desc: `Stop searching for Day ${i}. No warmer day found.`, i: i, j: j, ret: [...ret] });
                                break;
                            }

                            const jump = ret[j];
                            history.push({ type: 'pre_jump', activeLine: 7, desc: `Day ${j} is colder, BUT it knows a warmer day is ${jump} days away...`, i: i, j: j, ret: [...ret] });
                            j += jump;
                            history.push({ type: 'jump', activeLine: 7, desc: `JUMP! moved j to ${j}. (Skipped ${jump - 1} days)`, i: i, j: j, ret: [...ret], jumpFrom: j - jump, jumpTo: j });
                        }

                        if (j < n) {
                            history.push({ type: 'found_check', activeLine: 8, desc: `Loop ended. Found Day ${j} (${data[j]}¬∞) > Day ${i} (${ti}¬∞)!`, i: i, j: j, ret: [...ret] });
                            ret[i] = j - i;
                            history.push({ type: 'found_store', activeLine: 9, desc: `Store result: ${j} - ${i} = ${ret[i]} days.`, i: i, j: j, ret: [...ret] });
                        } else {
                            history.push({ type: 'none_found', activeLine: 8, desc: `Loop ended. j=${j} (Out of bounds). No warmer day.`, i: i, j: j, ret: [...ret] });
                        }
                    }

                    history.push({ type: 'done', activeLine: 2, desc: 'All days processed.', i: -1, j: -1, ret: [...ret] });
                    return history;
                }

                function initViz() {
                    const container = document.getElementById('viz-container');
                    const svg = document.getElementById('svg-overlay');
                    container.innerHTML = ''; // Keep SVG inside? No, rebuild
                    container.appendChild(svg);
                    svg.innerHTML = '';

                    const maxTemp = Math.max(...temps, 100);
                    const minTemp = Math.min(...temps, 0);

                    temps.forEach((t, idx) => {
                        const barContainer = document.createElement('div');
                        barContainer.className = 'bar-container';
                        barContainer.id = `cont-${idx}`;

                        const percent = Math.max(10, ((t - minTemp) / (maxTemp - minTemp)) * 80 + 10);

                        const bar = document.createElement('div');
                        bar.className = 'bar';
                        bar.id = `bar-${idx}`;
                        bar.style.height = `${percent}%`;

                        const val = document.createElement('div');
                        val.className = 'bar-value';
                        val.innerText = t;

                        const index = document.createElement('div');
                        index.className = 'bar-index';
                        index.innerText = idx;

                        const res = document.createElement('div');
                        res.className = 'bar-result';
                        res.id = `res-${idx}`;
                        res.innerText = '0';

                        barContainer.appendChild(val);
                        barContainer.appendChild(bar);
                        barContainer.appendChild(index);
                        barContainer.appendChild(res);
                        container.appendChild(barContainer);
                    });
                }

                function drawJumpArc(fromIdx, toIdx) {
                    const svg = document.getElementById('svg-overlay');
                    svg.innerHTML = ''; // Clear previous

                    if (fromIdx < 0 || toIdx < 0 || fromIdx >= temps.length || toIdx >= temps.length) return;

                    const cont1 = document.getElementById(`cont-${fromIdx}`);
                    const cont2 = document.getElementById(`cont-${toIdx}`);

                    // Get positions relative to container
                    const rect1 = cont1.getBoundingClientRect();
                    const rect2 = cont2.getBoundingClientRect();
                    const parentRect = document.getElementById('viz-container').getBoundingClientRect();

                    const x1 = rect1.left + rect1.width / 2 - parentRect.left;
                    const x2 = rect2.left + rect2.width / 2 - parentRect.left;
                    const y = 300; // Fixed baseline roughly

                    const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
                    // Draw Quadratic Curve
                    const cx = (x1 + x2) / 2;
                    const cy = y - (Math.abs(x2 - x1) / 2); // Height proportional to distance

                    const d = `M ${x1} ${y - 100} Q ${cx} ${cy - 150} ${x2} ${y - 100}`;

                    path.setAttribute("d", d);
                    path.setAttribute("stroke", "var(--jump-arc)");
                    path.setAttribute("stroke-width", "3");
                    path.setAttribute("fill", "none");
                    path.setAttribute("stroke-dasharray", "5,5");

                    // Add arrow
                    const marker = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                    marker.setAttribute("cx", x2);
                    marker.setAttribute("cy", y - 100);
                    marker.setAttribute("r", "5");
                    marker.setAttribute("fill", "var(--jump-arc)");

                    svg.appendChild(path);
                    svg.appendChild(marker);
                }

                function renderStep() {
                    if (currentStep >= steps.length) {
                        setIsPlaying(false);
                        return;
                    }

                    const s = steps[currentStep];

                    // 1. Text Updates
                    document.getElementById('status-text').innerText = s.desc;
                    document.getElementById('var-i').innerText = s.i === -1 ? '-' : s.i;
                    document.getElementById('var-ti').innerText = s.i === -1 || s.i >= temps.length ? '-' : temps[s.i];

                    document.getElementById('var-j').innerText = s.j === -1 || s.j >= temps.length ? (s.j >= temps.length ? 'OutOfBounds' : '-') : s.j;
                    document.getElementById('var-tj').innerText = s.j === -1 || s.j >= temps.length ? '-' : temps[s.j];
                    document.getElementById('var-rj').innerText = s.j === -1 || s.j >= temps.length ? '-' : (s.ret[s.j] !== undefined ? s.ret[s.j] : '-');

                    // 2. Code Highlight
                    document.querySelectorAll('.code-line').forEach(el => el.classList.remove('active'));
                    if (s.activeLine) document.getElementById(`line-${s.activeLine}`).classList.add('active');

                    // 3. Bar Styles
                    document.querySelectorAll('.bar').forEach(b => {
                        b.style.backgroundColor = 'var(--bar-default)';
                        b.style.opacity = '1';
                        b.style.transform = 'scale(1)';
                    });

                    // Highlight solved (right side)
                    for (let k = s.i + 1; k < temps.length; k++) {
                        if (k >= 0) {
                            const b = document.getElementById(`bar-${k}`);
                            b.style.opacity = '0.7';
                        }
                    }

                    // Highlight I
                    if (s.i >= 0 && s.i < temps.length) {
                        const b = document.getElementById(`bar-${s.i}`);
                        b.style.backgroundColor = 'var(--bar-current)';
                        b.style.opacity = '1';
                        b.style.transform = 'scale(1.05)';
                    }

                    // Highlight J
                    if (s.j >= 0 && s.j < temps.length) {
                        const b = document.getElementById(`bar-${s.j}`);
                        b.style.backgroundColor = 'var(--bar-j)';
                        b.style.opacity = '1';
                        b.style.transform = 'scale(1.05)';
                    }

                    // 4. Result Values
                    s.ret.forEach((val, idx) => {
                        const el = document.getElementById(`res-${idx}`);
                        el.innerText = val;
                        if (val !== 0 || idx > s.i) { // Show zeros if we passed them
                            el.classList.add('solved');
                        } else {
                            el.classList.remove('solved');
                        }
                    });

                    // clear arc
                    document.getElementById('svg-overlay').innerHTML = '';

                    // 5. Jump Arc
                    if (s.type === 'jump' && s.jumpFrom !== undefined && s.jumpTo !== undefined) {
                        drawJumpArc(s.jumpFrom, s.jumpTo);
                    }
                }

                function loadExample(idx) {
                    temps = EXAMPLES[idx];
                    steps = computeSteps(temps);
                    currentStep = 0;
                    setIsPlaying(false);
                    initViz();
                    renderStep();
                }

                function step() {
                    if (currentStep < steps.length - 1) {
                        currentStep++;
                        renderStep();
                    }
                }

                function reset() {
                    currentStep = 0;
                    setIsPlaying(false);
                    renderStep();
                }

                function setIsPlaying(val) {
                    isPlaying = val;
                    const btn = document.getElementById('play-btn');
                    btn.innerText = isPlaying ? '‚è∏ Pause' : '‚ñ∂ Play';
                    btn.classList.toggle('active', isPlaying);

                    if (isPlaying) {
                        playInterval = setInterval(() => {
                            if (currentStep < steps.length - 1) {
                                currentStep++;
                                renderStep();
                            } else {
                                setIsPlaying(false);
                            }
                        }, 600);
                    } else {
                        clearInterval(playInterval);
                    }
                }

                function play() {
                    setIsPlaying(!isPlaying);
                }

                // Init
                loadExample(0);

            </script>
</body>

</html>