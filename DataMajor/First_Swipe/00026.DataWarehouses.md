# Data Warehousing (Redshift / Snowflake)
### The English Version

---

## What is a Data Warehouse and Why Does it Exist?

**The Problem:**
Your company has 50 different applications (Salesforce for Sales, Postgres for App Data, Google Analytics for Marketing).
*   The CEO asks: *"Are users who click our ads actually buying our product?"*
*   You cannot answer this because the Ad Data is in Google and the Purchase Data is in Postgres. They are **Data Silos**.

**The Solution:**
A **Data Warehouse** is the "Single Source of Truth." It is a massive, central database where you copy *all* data from *all* applications so you can join them together.
*   **OLTP (Apps):** Optimized for writing transactions (Speed).
*   **OLAP (Warehouse):** Optimized for reading massive amounts of history (Analytics).

**Analogy:**
*   **Postgres (App DB):** The cash register at a store. Fast, handles one customer at a time.
*   **Data Warehouse (Snowflake):** The headquarters archive room. It has records from every store, for the last 10 years, organized so analysts can find trends.

---

## Core Concepts in Plain English

**ETL vs ELT:**
*   **ETL (Extract, Transform, Load):** Old school. Pull data, clean it on a separate server, then load it into the Warehouse. (Slow).
*   **ELT (Extract, Load, Transform):** Modern (Snowflake/Redshift). Dump the raw messy data into the Warehouse first, *then* use the Warehouse's massive power to clean it. (Fast).

**Fact Table vs Dimension Table:**
*   **Fact Table:** The "Verbs" (Actions). Highly repetitive, billions of rows.
    *   *Examples:* `Transactions`, `Logins`, `PageViews`.
    *   *Columns:* `user_id`, `product_id`, `amount`, `timestamp`.
*   **Dimension Table:** The "Nouns" (Context). Descriptive, smaller.
    *   *Examples:* `Users`, `Products`, `Locations`.
    *   *Columns:* `user_id`, `full_name`, `email`, `address`.

**Star Schema:**
The standard way to organize a Warehouse. A massive **Fact Table** in the middle, surrounded by **Dimension Tables**.
*   *Why:* It minimizes joined data redundancy. You store "John Doe" once in the Dimension table, not 50 million times in the Fact table.

**MPP (Massively Parallel Processing):**
*   If you run a query on Postgres, 1 CPU does the work.
*   If you run a query on Redshift/Snowflake, **128 CPUs** chunks the data and work on it simultaneously.

---

## Architecture / Deep Dive

**Shared-Nothing Architecture (Redshift / old school):**
*   Each node has its own CPU and its own Disk.
*   Data is "sharded" (distributed) across nodes.
*   *Problem:* If you need more storage, you have to buy more CPU. You can't scale them separately.

**Separation of Compute & Storage (Snowflake / BigQuery):**
*   **Storage (S3):** Data lives in cheap object storage. Infinite capacity.
*   **Compute (Virtual Warehouses):** Clusters of EC2 instances that spin up on demand to read from S3.
*   *Benefit:* You can have 10TB of data (Storage) but ZERO servers running (Compute) when no one is working. You pay for what you use.

**Columnar Storage:**
(See Databases section). Warehouses store data by column, not row, allowing for 50x compression and instant "Aggregation" queries (`SUM`, `AVG`).

---

## Data Warehousing at Capital One

**1. Regulatory Reporting (The "Must Have"):**
*   We must report every transaction to the Federal Reserve.
*   We use the Warehouse to join data from Credit Card, Auto Loan, and Bank Account systems into one unified "Risk Report."

**2. Credit Model Training:**
*   Data Scientists need 10 years of history to train a model.
*   They don't query the App DB (it would crash). They query the Warehouse (Snowflake), which can scan 5 Billion rows in 10 seconds.

**3. Marketing Segmentation:**
*   *"Find all users who live in Virginia, have a credit score > 700, and haven't logged in for 30 days."*
*   This requires joining the **User Dimension**, **Account Fact**, and **Login Fact** tables.

---

## Comparison Table

| Feature | Data Warehouse (Snowflake) | Data Lake (S3) | Data Mart |
| :--- | :--- | :--- | :--- |
| **Data Structure** | Highly Structured (Schema-on-Write) | Raw / Unstructured (Schema-on-Read) | Structured (Subset) |
| **Users** | Business Analysts (SQL) | Data Scientists (Python/Spark) | Specific Dept (e.g., Marketing) |
| **Cost** | High (Compute + Storage) | Low (Cheap Storage) | Moderate |
| **Agility** | Low (Must define schema first) | High (Just dump the files) | High |
| **Single Source of Truth** | **YES** | No (It's a swamp) | No (It's a silo) |

---

## Visuals

```text
THE STAR SCHEMA (The Blueprint of a Warehouse)
╔═══════════════════════════════════════════════════════════════════════╗
║                                                                       ║
║       [DIM_USERS]                 [DIM_PRODUCTS]                      ║
║       ┌───────────────┐           ┌───────────────┐                   ║
║       │ user_id (PK)  │           │ prod_id (PK)  │                   ║
║       │ name          │           │ category      │                   ║
║       │ state         │           │ price         │                   ║
║       └──────┬────────┘           └───────┬───────┘                   ║
║              │                            │                           ║
║              ▼                            ▼                           ║
║           ┌───────────────────────────────────┐                       ║
║           │            FACT_ORDERS            │                       ║
║           │           (The Center)            │                       ║
║           │ --------------------------------- │                       ║
║           │ order_id (PK)                     │                       ║
║           │ user_id (FK) ─────────────────────┘                       ║
║           │ prod_id (FK) ──────────────────────────────────┐          ║
║           │ date_id (FK) ─────────────────────┐            │          ║
║           │ amount                            │            │          ║
║           └───────────────────────────────────┘            │          ║
║                                               │            │          ║
║              ▲                                ▼            ▼          ║
║              │                            [DIM_DATE]   [DIM_STORE]    ║
║       [DIM_PROMOTIONS]                                                ║
║                                                                       ║
║   "Facts are events. Dimensions are the Who, What, Where, When."      ║
╚═══════════════════════════════════════════════════════════════════════╝
```
